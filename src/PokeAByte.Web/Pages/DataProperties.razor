@page "/DataProperties"
@using PokeAByte.Web.Components.Properties
<PageTitle>@PageTitle - Properties</PageTitle>

@if (!ClientService.IsCurrentlyConnected)
{
    <MudText Typo="Typo.h4" Color="Color.Error">No Mapper Loaded!</MudText>
}
else
{
    <MudText Typo="Typo.h5">
        All Properties
        @if (!string.IsNullOrWhiteSpace(MapperName))
        {
            <span> - @MapperName</span>
        }
    </MudText>
}
@if (PropertyItems.Any())
{
    <MudTreeView Items="PropertyItems"
                 Color="Color.Secondary"
                 Dense="true"
                 Hover="true"
                 ExpandOnClick="true"
                 Style="overflow-y:scroll; height: 80vh">
        <ItemTemplate>
            <MudTreeViewItem Items="@context.DisplayedChildren"
                             @bind-Expanded="@context.IsExpanded"
                             Value="@context"
                             Icon="@SetIcon(context)"
                             Text="@context.Name"
                             Style="overflow:hidden;">
                <BodyContent Context="bodyContext">
                    @if (context.IsLoadMoreItemsEntry)
                    {
                        <MudLink Color="Color.Success"
                                 OnClick="() => LoadMoreItems(context)">
                            @context.Name
                        </MudLink>
                    }
                    else if (context.Property is not null && context.IsParentExpanded)
                    {
                        <PropertyExpansionPanel Context="@context"
                                                TextWidth="@TextSize(context.Width)"/>
                        <MudText>@context.Index</MudText>
                    }
                    else
                    {
                        <MudText Class="py-2">@context.Name</MudText>
                    }
                </BodyContent>
            </MudTreeViewItem>
        </ItemTemplate>
    </MudTreeView>
}
else if (ClientService.IsCurrentlyConnected)
{
    <MudText Typo="Typo.body1">Loading Properties: </MudText>
    <MudProgressCircular Color="Color.Secondary" Indeterminate="true" />
}